<!DOCTYPE html>
<html lang="en" data-accent-color="blue" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Litestar Python.org Architecture - litestar-pydotorg</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Database Schema Design" href="DATABASE_SCHEMA.html" /><link rel="prev" title="Architecture" href="index.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=513f0650" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Litestar Python.org Architecture"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>litestar-pydotorg</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://python.org/">
            <span>Python.org</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/litestar-pydotorg" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Learn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/development.html">Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/contributing.html">Contribution Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/api-usage.html">API Usage Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/authentication.html">Authentication Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/feature-flags.html">Feature Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/configuration.html">Configuration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/deployment.html">Deployment Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker.html">Docker Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/troubleshooting.html">Troubleshooting Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/domain-patterns.html">Domain Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/authentication-recipes.html">Authentication Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/database-recipes.html">Database Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/testing-recipes.html">Testing Recipes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/core/index.html">Core Infrastructure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/core/auth.html">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/cache.html">Caching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/database.html">Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/email.html">Email</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/exceptions.html">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/features.html">Feature Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/feeds.html">RSS/Atom Feeds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/ical.html">iCalendar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/logging.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/middleware.html">Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/openapi.html">OpenAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/search.html">Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/security.html">Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core/worker.html">Background Worker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/domains/index.html">Domain Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/about.html">About</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/banners.html">banners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/blogs.html">blogs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/codesamples.html">Code Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/community.html">community</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/docs.html">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/downloads.html">downloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/events.html">events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/jobs.html">jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/mailing.html">Mailing Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/minutes.html">Minutes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/nominations.html">Nominations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/pages.html">pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/search.html">Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/sponsors.html">sponsors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/sqladmin.html">SQLAdmin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/successstories.html">Success Stories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/users.html">users</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/domains/work_groups.html">Work Groups</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/lib.html">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tasks.html">Background Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/main.html">Application Entry Point</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Litestar Python.org Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="DATABASE_SCHEMA.html">Database Schema Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="DOMAIN_MODELS.html">Domain Models Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="QUICK_START.html">Litestar Python.org Quick Start Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_TAGS_INDEX.html">API Tags Documentation Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="RATE_LIMITING_ARCHITECTURE.html">Rate Limiting Architecture Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="adr/001-litestar-framework.html">ADR-001: Use Litestar as Web Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="adr/002-saq-background-tasks.html">ADR-002: Use SAQ for Background Task Processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JacobCoffee/litestar-pydotorg">GitHub</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#executive-summary">Executive Summary</a></li>
<li><a class="reference internal" href="#system-overview">System Overview</a><ul>
<li><a class="reference internal" href="#current-django-architecture">Current Django Architecture</a></li>
<li><a class="reference internal" href="#target-litestar-architecture">Target Litestar Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technology-stack">Technology Stack</a><ul>
<li><a class="reference internal" href="#core-framework-stack">Core Framework Stack</a></li>
<li><a class="reference internal" href="#development-quality-tools">Development &amp; Quality Tools</a></li>
<li><a class="reference internal" href="#infrastructure-devops">Infrastructure &amp; DevOps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-structure">Project Structure</a><ul>
<li><a class="reference internal" href="#directory-layout">Directory Layout</a></li>
<li><a class="reference internal" href="#module-organization-pattern">Module Organization Pattern</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domain-model">Domain Model</a><ul>
<li><a class="reference internal" href="#domain-mapping-django-apps-litestar-domains">Domain Mapping (Django Apps &#8594; Litestar Domains)</a></li>
<li><a class="reference internal" href="#cross-domain-dependencies">Cross-Domain Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#database-architecture">Database Architecture</a><ul>
<li><a class="reference internal" href="#schema-design-principles">Schema Design Principles</a></li>
<li><a class="reference internal" href="#base-model">Base Model</a></li>
<li><a class="reference internal" href="#key-models-overview">Key Models Overview</a><ul>
<li><a class="reference internal" href="#users-domain">Users Domain</a></li>
<li><a class="reference internal" href="#pages-domain">Pages Domain</a></li>
<li><a class="reference internal" href="#downloads-domain">Downloads Domain</a></li>
<li><a class="reference internal" href="#events-domain">Events Domain</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-from-django">Migration from Django</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-design">API Design</a><ul>
<li><a class="reference internal" href="#api-architecture">API Architecture</a></li>
<li><a class="reference internal" href="#api-v2-design-principles">API v2 Design Principles</a></li>
<li><a class="reference internal" href="#response-format">Response Format</a></li>
<li><a class="reference internal" href="#example-api-routes">Example API Routes</a></li>
<li><a class="reference internal" href="#openapi-configuration">OpenAPI Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-authorization">Authentication &amp; Authorization</a><ul>
<li><a class="reference internal" href="#authentication-strategy">Authentication Strategy</a></li>
<li><a class="reference internal" href="#implementation-approach">Implementation Approach</a></li>
<li><a class="reference internal" href="#authorization-patterns">Authorization Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-management">Configuration Management</a><ul>
<li><a class="reference internal" href="#environment-based-configuration">Environment-Based Configuration</a></li>
<li><a class="reference internal" href="#environment-files">Environment Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#background-tasks">Background Tasks</a><ul>
<li><a class="reference internal" href="#saq-integration">SAQ Integration</a></li>
<li><a class="reference internal" href="#task-scheduling">Task Scheduling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-strategy">Migration Strategy</a><ul>
<li><a class="reference internal" href="#phase-1-foundation-weeks-1-2">Phase 1: Foundation (Weeks 1-2)</a></li>
<li><a class="reference internal" href="#phase-2-core-domains-weeks-3-5">Phase 2: Core Domains (Weeks 3-5)</a></li>
<li><a class="reference internal" href="#phase-3-feature-domains-weeks-6-9">Phase 3: Feature Domains (Weeks 6-9)</a></li>
<li><a class="reference internal" href="#phase-4-templates-frontend-weeks-10-11">Phase 4: Templates &amp; Frontend (Weeks 10-11)</a></li>
<li><a class="reference internal" href="#phase-5-background-tasks-integration-week-12">Phase 5: Background Tasks &amp; Integration (Week 12)</a></li>
<li><a class="reference internal" href="#phase-6-testing-optimization-weeks-13-14">Phase 6: Testing &amp; Optimization (Weeks 13-14)</a></li>
<li><a class="reference internal" href="#phase-7-deployment-cutover-weeks-15-16">Phase 7: Deployment &amp; Cutover (Weeks 15-16)</a></li>
<li><a class="reference internal" href="#data-migration-script">Data Migration Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li><a class="reference internal" href="#database-optimization">Database Optimization</a></li>
<li><a class="reference internal" href="#response-optimization">Response Optimization</a></li>
<li><a class="reference internal" href="#async-best-practices">Async Best Practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-architecture">Security Architecture</a><ul>
<li><a class="reference internal" href="#security-principles">Security Principles</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#input-validation">Input Validation</a></li>
<li><a class="reference internal" href="#rate-limiting">Rate Limiting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendices">Appendices</a><ul>
<li><a class="reference internal" href="#a-technology-decision-records">A. Technology Decision Records</a><ul>
<li><a class="reference internal" href="#adr-001-litestar-over-fastapi">ADR-001: Litestar over FastAPI</a></li>
<li><a class="reference internal" href="#adr-002-saq-over-celery">ADR-002: SAQ over Celery</a></li>
<li><a class="reference internal" href="#adr-003-meilisearch-over-elasticsearch">ADR-003: Meilisearch over Elasticsearch</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-file-templates">B. File Templates</a></li>
<li><a class="reference internal" href="#c-development-guidelines">C. Development Guidelines</a></li>
</ul>
</li>
<li><a class="reference internal" href="#revision-history">Revision History</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">litestar-pydotorg</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Architecture</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Litestar Python.org Architecture</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue dark-code" role="main">
          <section id="litestar-python-org-architecture">
<h1>Litestar <a class="reference external" href="http://Python.org">Python.org</a> Architecture<a class="headerlink" href="#litestar-python-org-architecture" title="Link to this heading">¶</a></h1>
<section id="executive-summary">
<h2>Executive Summary<a class="headerlink" href="#executive-summary" title="Link to this heading">¶</a></h2>
<p>This document outlines the comprehensive architecture for migrating <a class="reference external" href="http://python.org">python.org</a> from Django to Litestar. The migration preserves all functionality while modernizing the tech stack to leverage async Python, type safety, and modern architectural patterns.</p>
<p><strong>Status</strong>: Proposed
<strong>Version</strong>: 1.0
<strong>Date</strong>: 2025-11-25
<strong>Target Litestar Version</strong>: 2.x
<strong>Python Version</strong>: 3.12+</p>
</section>
<hr class="docutils" />
<section id="system-overview">
<h2>System Overview<a class="headerlink" href="#system-overview" title="Link to this heading">¶</a></h2>
<section id="current-django-architecture">
<h3>Current Django Architecture<a class="headerlink" href="#current-django-architecture" title="Link to this heading">¶</a></h3>
<p>The existing <a class="reference external" href="http://python.org">python.org</a> Django application consists of:</p>
<ul class="simple">
<li><p><strong>17 Django Apps</strong>: banners, blogs, boxes, cms, codesamples, community, companies, downloads, events, jobs, mailing, minutes, nominations, pages, sponsors, successstories, users, work_groups</p></li>
<li><p><strong>41 Database Tables</strong> (across all migrations)</p></li>
<li><p><strong>Authentication</strong>: django-allauth for OAuth and email/username auth</p></li>
<li><p><strong>Background Tasks</strong>: Celery with Redis broker</p></li>
<li><p><strong>Search</strong>: Haystack integration</p></li>
<li><p><strong>Static Assets</strong>: Django Pipeline for CSS/JS compilation</p></li>
<li><p><strong>Cache Invalidation</strong>: Fastly CDN integration</p></li>
<li><p><strong>APIs</strong>: Both Tastypie (v1) and Django REST Framework (v2)</p></li>
</ul>
</section>
<section id="target-litestar-architecture">
<h3>Target Litestar Architecture<a class="headerlink" href="#target-litestar-architecture" title="Link to this heading">¶</a></h3>
<p>The new architecture will be:</p>
<ul class="simple">
<li><p><strong>Modular Domain-Driven</strong>: Each Django app becomes a domain module</p></li>
<li><p><strong>Async-First</strong>: Leveraging SQLAlchemy 2.0 async capabilities</p></li>
<li><p><strong>Type-Safe</strong>: Full type hints with Pydantic v2</p></li>
<li><p><strong>Modern Tooling</strong>: uv, Ruff, SAQ for background tasks</p></li>
<li><p><strong>API-Centric</strong>: RESTful API with automatic OpenAPI documentation</p></li>
<li><p><strong>Cloud-Native</strong>: Container-ready with proper health checks</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="technology-stack">
<h2>Technology Stack<a class="headerlink" href="#technology-stack" title="Link to this heading">¶</a></h2>
<section id="core-framework-stack">
<h3>Core Framework Stack<a class="headerlink" href="#core-framework-stack" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Technology</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>Rationale</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Web Framework</strong></p></td>
<td><p>Litestar</p></td>
<td><p>2.x</p></td>
<td><p>Modern async framework with excellent DX</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ORM</strong></p></td>
<td><p>SQLAlchemy</p></td>
<td><p>2.0+</p></td>
<td><p>Industry standard, async support, type-safe</p></td>
</tr>
<tr class="row-even"><td><p><strong>ORM Helper</strong></p></td>
<td><p>Advanced Alchemy</p></td>
<td><p>latest</p></td>
<td><p>Litestar-native database utilities</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Migrations</strong></p></td>
<td><p>Alembic</p></td>
<td><p>latest</p></td>
<td><p>SQLAlchemy’s migration tool</p></td>
</tr>
<tr class="row-even"><td><p><strong>Validation</strong></p></td>
<td><p>Pydantic</p></td>
<td><p>2.x</p></td>
<td><p>Type-safe data validation, Litestar native</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Templates</strong></p></td>
<td><p>Jinja2</p></td>
<td><p>3.x</p></td>
<td><p>Compatible with Django templates</p></td>
</tr>
<tr class="row-even"><td><p><strong>Background Tasks</strong></p></td>
<td><p>SAQ</p></td>
<td><p>latest</p></td>
<td><p>Async task queue, simpler than Celery</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Cache</strong></p></td>
<td><p>Redis</p></td>
<td><p>7.x</p></td>
<td><p>Session storage, task queue backend</p></td>
</tr>
<tr class="row-even"><td><p><strong>Search</strong></p></td>
<td><p>Meilisearch</p></td>
<td><p>latest</p></td>
<td><p>Modern, fast alternative to Elasticsearch</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Package Manager</strong></p></td>
<td><p>uv</p></td>
<td><p>latest</p></td>
<td><p>Fast, reliable dependency management</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="development-quality-tools">
<h3>Development &amp; Quality Tools<a class="headerlink" href="#development-quality-tools" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Tool</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Ruff</strong></p></td>
<td><p>Linting and formatting</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Mypy</strong></p></td>
<td><p>Static type checking</p></td>
</tr>
<tr class="row-even"><td><p><strong>Pytest</strong></p></td>
<td><p>Testing framework</p></td>
</tr>
<tr class="row-odd"><td><p><strong>pytest-asyncio</strong></p></td>
<td><p>Async test support</p></td>
</tr>
<tr class="row-even"><td><p><strong>httpx</strong></p></td>
<td><p>Async HTTP client for testing</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Factory Boy</strong></p></td>
<td><p>Test data generation</p></td>
</tr>
<tr class="row-even"><td><p><strong>Faker</strong></p></td>
<td><p>Fake data generation</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="infrastructure-devops">
<h3>Infrastructure &amp; DevOps<a class="headerlink" href="#infrastructure-devops" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Technology</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Database</strong></p></td>
<td><p>PostgreSQL 15+</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Container</strong></p></td>
<td><p>Docker with multi-stage builds</p></td>
</tr>
<tr class="row-even"><td><p><strong>Orchestration</strong></p></td>
<td><p>Docker Compose (dev), Kubernetes (prod)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Reverse Proxy</strong></p></td>
<td><p>Nginx or Caddy</p></td>
</tr>
<tr class="row-even"><td><p><strong>CDN</strong></p></td>
<td><p>Fastly (maintained)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Monitoring</strong></p></td>
<td><p>Prometheus + Grafana</p></td>
</tr>
<tr class="row-even"><td><p><strong>Logging</strong></p></td>
<td><p>Structured logging with Structlog</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="project-structure">
<h2>Project Structure<a class="headerlink" href="#project-structure" title="Link to this heading">¶</a></h2>
<section id="directory-layout">
<h3>Directory Layout<a class="headerlink" href="#directory-layout" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">litestar-pydotorg/
</span><span data-line="2">├── pyproject.toml              # Project metadata &amp; dependencies
</span><span data-line="3">├── uv.lock                     # Locked dependencies
</span><span data-line="4">├── .python-version             # Python version pin
</span><span data-line="5">├── alembic.ini                 # Database migration config
</span><span data-line="6">│
</span><span data-line="7">├── src/
</span><span data-line="8">│   └── pydotorg/
</span><span data-line="9">│       ├── __init__.py
</span><span data-line="10">│       ├── main.py             # Application entry point
</span><span data-line="11">│       ├── config.py           # Configuration management
</span><span data-line="12">│       ├── deps.py             # Dependency injection
</span><span data-line="13">│       │
</span><span data-line="14">│       ├── core/               # Core infrastructure
</span><span data-line="15">│       │   ├── __init__.py
</span><span data-line="16">│       │   ├── auth/           # Authentication &amp; authorization
</span><span data-line="17">│       │   ├── cache/          # Caching utilities
</span><span data-line="18">│       │   ├── database/       # Database configuration
</span><span data-line="19">│       │   ├── exceptions/     # Custom exceptions
</span><span data-line="20">│       │   ├── middleware/     # Custom middleware
</span><span data-line="21">│       │   ├── security/       # Security utilities
</span><span data-line="22">│       │   └── templates/      # Template configuration
</span><span data-line="23">│       │
</span><span data-line="24">│       ├── lib/                # Shared utilities
</span><span data-line="25">│       │   ├── __init__.py
</span><span data-line="26">│       │   ├── dto/            # Data Transfer Objects
</span><span data-line="27">│       │   ├── guards/         # Route guards
</span><span data-line="28">│       │   ├── schemas/        # Pydantic schemas
</span><span data-line="29">│       │   └── utils/          # Helper functions
</span><span data-line="30">│       │
</span><span data-line="31">│       ├── domains/            # Domain modules (former Django apps)
</span><span data-line="32">│       │   ├── __init__.py
</span><span data-line="33">│       │   │
</span><span data-line="34">│       │   ├── users/
</span><span data-line="35">│       │   │   ├── __init__.py
</span><span data-line="36">│       │   │   ├── models.py       # SQLAlchemy models
</span><span data-line="37">│       │   │   ├── schemas.py      # Pydantic schemas
</span><span data-line="38">│       │   │   ├── services.py     # Business logic
</span><span data-line="39">│       │   │   ├── controllers.py  # HTTP handlers
</span><span data-line="40">│       │   │   ├── dependencies.py # Domain-specific deps
</span><span data-line="41">│       │   │   └── guards.py       # Domain-specific guards
</span><span data-line="42">│       │   │
</span><span data-line="43">│       │   ├── pages/
</span><span data-line="44">│       │   │   ├── __init__.py
</span><span data-line="45">│       │   │   ├── models.py
</span><span data-line="46">│       │   │   ├── schemas.py
</span><span data-line="47">│       │   │   ├── services.py
</span><span data-line="48">│       │   │   ├── controllers.py
</span><span data-line="49">│       │   │   └── repositories.py # Data access layer
</span><span data-line="50">│       │   │
</span><span data-line="51">│       │   ├── downloads/
</span><span data-line="52">│       │   ├── events/
</span><span data-line="53">│       │   ├── jobs/
</span><span data-line="54">│       │   ├── community/
</span><span data-line="55">│       │   ├── sponsors/
</span><span data-line="56">│       │   ├── blogs/
</span><span data-line="57">│       │   └── [... other domains]
</span><span data-line="58">│       │
</span><span data-line="59">│       ├── tasks/              # Background tasks
</span><span data-line="60">│       │   ├── __init__.py
</span><span data-line="61">│       │   ├── base.py
</span><span data-line="62">│       │   ├── downloads.py
</span><span data-line="63">│       │   ├── events.py
</span><span data-line="64">│       │   └── search.py
</span><span data-line="65">│       │
</span><span data-line="66">│       └── api/                # API versioning
</span><span data-line="67">│           ├── __init__.py
</span><span data-line="68">│           ├── v1/             # Legacy API compatibility
</span><span data-line="69">│           └── v2/             # Modern API
</span><span data-line="70">│
</span><span data-line="71">├── migrations/                 # Alembic migrations
</span><span data-line="72">│   ├── versions/
</span><span data-line="73">│   └── env.py
</span><span data-line="74">│
</span><span data-line="75">├── templates/                  # Jinja2 templates
</span><span data-line="76">│   ├── base.html
</span><span data-line="77">│   ├── users/
</span><span data-line="78">│   ├── pages/
</span><span data-line="79">│   └── [... domain templates]
</span><span data-line="80">│
</span><span data-line="81">├── static/                     # Static assets
</span><span data-line="82">│   ├── css/
</span><span data-line="83">│   ├── js/
</span><span data-line="84">│   └── img/
</span><span data-line="85">│
</span><span data-line="86">├── tests/                      # Test suite
</span><span data-line="87">│   ├── conftest.py
</span><span data-line="88">│   ├── unit/
</span><span data-line="89">│   ├── integration/
</span><span data-line="90">│   └── e2e/
</span><span data-line="91">│
</span><span data-line="92">├── scripts/                    # Utility scripts
</span><span data-line="93">│   ├── import_django_data.py
</span><span data-line="94">│   └── setup_dev.sh
</span><span data-line="95">│
</span><span data-line="96">└── docs/                       # Documentation
</span><span data-line="97">    ├── architecture/
</span><span data-line="98">    ├── api/
</span><span data-line="99">    └── deployment/
</span></pre></div>
</div>
</section>
<section id="module-organization-pattern">
<h3>Module Organization Pattern<a class="headerlink" href="#module-organization-pattern" title="Link to this heading">¶</a></h3>
<p>Each domain follows a consistent structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># domains/example/models.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pydotorg.core.database</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span><span data-line="6">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="9">    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># domains/example/schemas.py</span>
</span><span data-line="12"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span>
</span><span data-line="13">
</span><span data-line="14"><span class="k">class</span><span class="w"> </span><span class="nc">ExampleRead</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="15">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17">    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="18">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="19">
</span><span data-line="20"><span class="k">class</span><span class="w"> </span><span class="nc">ExampleCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="21">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># domains/example/services.py</span>
</span><span data-line="24"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Protocol</span>
</span><span data-line="25"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
</span><span data-line="26">
</span><span data-line="27"><span class="k">class</span><span class="w"> </span><span class="nc">ExampleService</span><span class="p">:</span>
</span><span data-line="28">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
</span><span data-line="29">        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
</span><span data-line="30">
</span><span data-line="31">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ExampleCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Example</span><span class="p">:</span>
</span><span data-line="32">        <span class="o">...</span>
</span><span data-line="33">
</span><span data-line="34"><span class="c1"># domains/example/controllers.py</span>
</span><span data-line="35"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="36"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="37">
</span><span data-line="38"><span class="k">class</span><span class="w"> </span><span class="nc">ExampleController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="39">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/examples&quot;</span>
</span><span data-line="40">    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">get_example_service</span><span class="p">)}</span>
</span><span data-line="41">
</span><span data-line="42">    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span data-line="43">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="n">ExampleService</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ExampleRead</span><span class="p">]:</span>
</span><span data-line="44">        <span class="o">...</span>
</span><span data-line="45">
</span><span data-line="46">    <span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span data-line="47">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_example</span><span class="p">(</span>
</span><span data-line="48">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="49">        <span class="n">data</span><span class="p">:</span> <span class="n">ExampleCreate</span><span class="p">,</span>
</span><span data-line="50">        <span class="n">service</span><span class="p">:</span> <span class="n">ExampleService</span>
</span><span data-line="51">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExampleRead</span><span class="p">:</span>
</span><span data-line="52">        <span class="o">...</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="domain-model">
<h2>Domain Model<a class="headerlink" href="#domain-model" title="Link to this heading">¶</a></h2>
<section id="domain-mapping-django-apps-litestar-domains">
<h3>Domain Mapping (Django Apps → Litestar Domains)<a class="headerlink" href="#domain-mapping-django-apps-litestar-domains" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Django App</p></th>
<th class="head"><p>Litestar Domain</p></th>
<th class="head"><p>Primary Responsibility</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>users</p></td>
<td><p>domains/users</p></td>
<td><p>User management, authentication, membership</p></td>
</tr>
<tr class="row-odd"><td><p>pages</p></td>
<td><p>domains/pages</p></td>
<td><p>CMS pages, flat content</p></td>
</tr>
<tr class="row-even"><td><p>downloads</p></td>
<td><p>domains/downloads</p></td>
<td><p>Python releases, files, OS listings</p></td>
</tr>
<tr class="row-odd"><td><p>events</p></td>
<td><p>domains/events</p></td>
<td><p>Calendar, events, recurring rules</p></td>
</tr>
<tr class="row-even"><td><p>jobs</p></td>
<td><p>domains/jobs</p></td>
<td><p>Job board postings, categories</p></td>
</tr>
<tr class="row-odd"><td><p>community</p></td>
<td><p>domains/community</p></td>
<td><p>Posts, media (photos/videos/links)</p></td>
</tr>
<tr class="row-even"><td><p>sponsors</p></td>
<td><p>domains/sponsors</p></td>
<td><p>Sponsorship management</p></td>
</tr>
<tr class="row-odd"><td><p>blogs</p></td>
<td><p>domains/blogs</p></td>
<td><p>Blog aggregation</p></td>
</tr>
<tr class="row-even"><td><p>boxes</p></td>
<td><p>domains/boxes</p></td>
<td><p>Content widgets/boxes</p></td>
</tr>
<tr class="row-odd"><td><p>cms</p></td>
<td><p>domains/cms</p></td>
<td><p>Base CMS functionality (mixin patterns)</p></td>
</tr>
<tr class="row-even"><td><p>banners</p></td>
<td><p>domains/banners</p></td>
<td><p>Banner management</p></td>
</tr>
<tr class="row-odd"><td><p>codesamples</p></td>
<td><p>domains/codesamples</p></td>
<td><p>Code snippet repository</p></td>
</tr>
<tr class="row-even"><td><p>companies</p></td>
<td><p>domains/companies</p></td>
<td><p>Company directory</p></td>
</tr>
<tr class="row-odd"><td><p>mailing</p></td>
<td><p>domains/mailing</p></td>
<td><p>Mailing list integration</p></td>
</tr>
<tr class="row-even"><td><p>minutes</p></td>
<td><p>domains/minutes</p></td>
<td><p>Board meeting minutes</p></td>
</tr>
<tr class="row-odd"><td><p>nominations</p></td>
<td><p>domains/nominations</p></td>
<td><p>PSF nominations</p></td>
</tr>
<tr class="row-even"><td><p>successstories</p></td>
<td><p>domains/successstories</p></td>
<td><p>Success story content</p></td>
</tr>
<tr class="row-odd"><td><p>work_groups</p></td>
<td><p>domains/work_groups</p></td>
<td><p>PSF working groups</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="cross-domain-dependencies">
<h3>Cross-Domain Dependencies<a class="headerlink" href="#cross-domain-dependencies" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">users (core)
</span><span data-line="2">  ↑
</span><span data-line="3">  ├── pages (depends on users for creator)
</span><span data-line="4">  ├── events (depends on users for creator)
</span><span data-line="5">  ├── jobs (depends on users for submitter)
</span><span data-line="6">  ├── community (depends on users for creator)
</span><span data-line="7">  └── sponsors (depends on users for membership)
</span><span data-line="8">
</span><span data-line="9">downloads
</span><span data-line="10">  ↑
</span><span data-line="11">  └── boxes (downloads box generation)
</span><span data-line="12">
</span><span data-line="13">events
</span><span data-line="14">  ↑
</span><span data-line="15">  └── community (event posts)
</span></pre></div>
</div>
<p><strong>Design Principle</strong>: Minimize circular dependencies. Core domains (users, cms) have no dependencies. Feature domains depend on core but not each other.</p>
</section>
</section>
<hr class="docutils" />
<section id="database-architecture">
<h2>Database Architecture<a class="headerlink" href="#database-architecture" title="Link to this heading">¶</a></h2>
<section id="schema-design-principles">
<h3>Schema Design Principles<a class="headerlink" href="#schema-design-principles" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Async SQLAlchemy 2.0</strong>: Use <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code> throughout</p></li>
<li><p><strong>Type Annotations</strong>: Full <code class="docutils literal notranslate"><span class="pre">Mapped[]</span></code> type hints</p></li>
<li><p><strong>Base Model Pattern</strong>: Common fields in abstract base</p></li>
<li><p><strong>Indexes</strong>: Strategic indexing for query patterns</p></li>
<li><p><strong>Constraints</strong>: Database-level integrity enforcement</p></li>
</ol>
</section>
<section id="base-model">
<h3>Base Model<a class="headerlink" href="#base-model" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">func</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span><span class="p">,</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
</span><span data-line="7"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base for all database models.&quot;&quot;&quot;</span>
</span><span data-line="8">    <span class="k">pass</span>
</span><span data-line="9">
</span><span data-line="10"><span class="k">class</span><span class="w"> </span><span class="nc">TimestampMixin</span><span class="p">:</span>
</span><span data-line="11"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin for created/updated timestamps.&quot;&quot;&quot;</span>
</span><span data-line="12">    <span class="n">created</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="13">        <span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="14">        <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span data-line="15">        <span class="n">index</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="16">    <span class="p">)</span>
</span><span data-line="17">    <span class="n">updated</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="18">        <span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="19">        <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span data-line="20">        <span class="n">onupdate</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span data-line="21">    <span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="k">class</span><span class="w"> </span><span class="nc">CreatorMixin</span><span class="p">:</span>
</span><span data-line="24"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin for creator tracking.&quot;&quot;&quot;</span>
</span><span data-line="25">    <span class="n">creator_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="26">        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">),</span>
</span><span data-line="27">        <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="28">    <span class="p">)</span>
</span><span data-line="29">    <span class="n">last_modified_by_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="30">        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">),</span>
</span><span data-line="31">        <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="32">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="key-models-overview">
<h3>Key Models Overview<a class="headerlink" href="#key-models-overview" title="Link to this heading">¶</a></h3>
<section id="users-domain">
<h4>Users Domain<a class="headerlink" href="#users-domain" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># users/models.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Text</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span><span class="p">,</span> <span class="n">relationship</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">):</span>
</span><span data-line="6">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;users&quot;</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="9">    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="10">    <span class="n">email</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">254</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="11">    <span class="n">password_hash</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="n">first_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">150</span><span class="p">))</span>
</span><span data-line="14">    <span class="n">last_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">150</span><span class="p">))</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="n">is_active</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="17">    <span class="n">is_staff</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="18">    <span class="n">is_superuser</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="c1"># Profile fields</span>
</span><span data-line="21">    <span class="n">bio</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span data-line="22">    <span class="n">bio_markup_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="n">search_visibility</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="25">    <span class="n">email_privacy</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="26">    <span class="n">public_profile</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="c1"># Relationships</span>
</span><span data-line="29">    <span class="n">membership</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Membership&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
</span><span data-line="30">        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;creator&quot;</span><span class="p">,</span>
</span><span data-line="31">        <span class="n">uselist</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="32">    <span class="p">)</span>
</span><span data-line="33">
</span><span data-line="34"><span class="k">class</span><span class="w"> </span><span class="nc">Membership</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">):</span>
</span><span data-line="35">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;memberships&quot;</span>
</span><span data-line="36">
</span><span data-line="37">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="38">    <span class="n">creator_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="39">        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>
</span><span data-line="40">        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="41">    <span class="p">)</span>
</span><span data-line="42">
</span><span data-line="43">    <span class="n">membership_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="44">    <span class="n">legal_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="45">    <span class="n">preferred_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="46">    <span class="n">email_address</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="47">
</span><span data-line="48">    <span class="n">city</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="49">    <span class="n">region</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="50">    <span class="n">country</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="51">    <span class="n">postal_code</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</span><span data-line="52">
</span><span data-line="53">    <span class="n">psf_code_of_conduct</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span data-line="54">    <span class="n">psf_announcements</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span data-line="55">    <span class="n">votes</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="56">    <span class="n">last_vote_affirmation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]]</span>
</span><span data-line="57">
</span><span data-line="58">    <span class="n">creator</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;membership&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="pages-domain">
<h4>Pages Domain<a class="headerlink" href="#pages-domain" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># pages/models.py</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">Page</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;pages&quot;</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="6">    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="7">    <span class="n">keywords</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
</span><span data-line="8">    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="n">path</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="11">        <span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
</span><span data-line="12">        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="13">        <span class="n">index</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="14">    <span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="n">content</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span data-line="17">    <span class="n">content_markup_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="18">        <span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
</span><span data-line="19">        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;restructuredtext&quot;</span>
</span><span data-line="20">    <span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="n">is_published</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="23">    <span class="n">content_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;text/html&quot;</span><span class="p">)</span>
</span><span data-line="24">    <span class="n">template_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="25">
</span><span data-line="26">    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="27">        <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;ix_pages_path_published&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;is_published&#39;</span><span class="p">),</span>
</span><span data-line="28">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="downloads-domain">
<h4>Downloads Domain<a class="headerlink" href="#downloads-domain" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># downloads/models.py</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">OS</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;operating_systems&quot;</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="6">    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="7">    <span class="n">slug</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="n">releases</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ReleaseFile&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;os&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="k">class</span><span class="w"> </span><span class="nc">Release</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="12">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;releases&quot;</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="15">    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="16">    <span class="n">slug</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="n">version</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="19">    <span class="n">is_latest</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="20">    <span class="n">is_published</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="21">    <span class="n">pre_release</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="22">    <span class="n">show_on_download_page</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="n">release_date</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span data-line="25">    <span class="n">release_page_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="26">        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;pages.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">)</span>
</span><span data-line="27">    <span class="p">)</span>
</span><span data-line="28">    <span class="n">release_notes_url</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="29">
</span><span data-line="30">    <span class="n">content</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span data-line="31">    <span class="n">content_markup_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span>
</span><span data-line="32">
</span><span data-line="33">    <span class="n">files</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ReleaseFile&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35"><span class="k">class</span><span class="w"> </span><span class="nc">ReleaseFile</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="36">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;release_files&quot;</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="39">    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="40">    <span class="n">slug</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="41">
</span><span data-line="42">    <span class="n">os_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;operating_systems.id&quot;</span><span class="p">))</span>
</span><span data-line="43">    <span class="n">release_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;releases.id&quot;</span><span class="p">))</span>
</span><span data-line="44">
</span><span data-line="45">    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span data-line="46">    <span class="n">is_source</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="47">    <span class="n">url</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="48">
</span><span data-line="49">    <span class="n">gpg_signature_file</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="50">    <span class="n">sigstore_signature_file</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="51">    <span class="n">sigstore_cert_file</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="52">    <span class="n">sigstore_bundle_file</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="53">    <span class="n">sbom_spdx2_file</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="54">
</span><span data-line="55">    <span class="n">md5_sum</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="56">    <span class="n">filesize</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="57">    <span class="n">download_button</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="58">
</span><span data-line="59">    <span class="n">os</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;OS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;releases&quot;</span><span class="p">)</span>
</span><span data-line="60">    <span class="n">release</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;Release&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
</span><span data-line="61">
</span><span data-line="62">    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="63">        <span class="n">UniqueConstraint</span><span class="p">(</span>
</span><span data-line="64">            <span class="s1">&#39;os_id&#39;</span><span class="p">,</span> <span class="s1">&#39;release_id&#39;</span><span class="p">,</span>
</span><span data-line="65">            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;uq_one_download_per_os_per_release&#39;</span><span class="p">,</span>
</span><span data-line="66">            <span class="n">sqlite_where</span><span class="o">=</span><span class="s1">&#39;download_button = true&#39;</span>
</span><span data-line="67">        <span class="p">),</span>
</span><span data-line="68">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="events-domain">
<h4>Events Domain<a class="headerlink" href="#events-domain" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># events/models.py</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">Calendar</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;calendars&quot;</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="6">    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span data-line="7">    <span class="n">slug</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="8">    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="n">url</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="11">    <span class="n">rss</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="12">    <span class="n">embed</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="13">    <span class="n">twitter</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="n">events</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;calendar&quot;</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">CreatorMixin</span><span class="p">):</span>
</span><span data-line="18">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;events&quot;</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="nb">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="21">    <span class="n">uid</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="22">    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="n">calendar_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;calendars.id&quot;</span><span class="p">))</span>
</span><span data-line="25">    <span class="n">venue_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="26">        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;event_locations.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">)</span>
</span><span data-line="27">    <span class="p">)</span>
</span><span data-line="28">
</span><span data-line="29">    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span data-line="30">    <span class="n">description_markup_type</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
</span><span data-line="31">        <span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
</span><span data-line="32">        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;restructuredtext&quot;</span>
</span><span data-line="33">    <span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35">    <span class="n">featured</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37">    <span class="n">calendar</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;Calendar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;events&quot;</span><span class="p">)</span>
</span><span data-line="38">    <span class="n">venue</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventLocation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">()</span>
</span><span data-line="39">    <span class="n">categories</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;EventCategory&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
</span><span data-line="40">        <span class="n">secondary</span><span class="o">=</span><span class="s2">&quot;event_category_associations&quot;</span>
</span><span data-line="41">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="migration-from-django">
<h3>Migration from Django<a class="headerlink" href="#migration-from-django" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Field Mapping</strong>:</p>
<ul class="simple">
<li><p>Django <code class="docutils literal notranslate"><span class="pre">CharField</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">String</span></code></p></li>
<li><p>Django <code class="docutils literal notranslate"><span class="pre">TextField</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">Text</span></code></p></li>
<li><p>Django <code class="docutils literal notranslate"><span class="pre">BooleanField</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">Boolean</span></code></p></li>
<li><p>Django <code class="docutils literal notranslate"><span class="pre">DateTimeField</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">DateTime(timezone=True)</span></code></p></li>
<li><p>Django <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> + <code class="docutils literal notranslate"><span class="pre">relationship</span></code></p></li>
</ul>
</li>
<li><p><strong>Default Values</strong>:</p>
<ul class="simple">
<li><p>Django <code class="docutils literal notranslate"><span class="pre">default=timezone.now</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">server_default=func.now()</span></code></p></li>
<li><p>Python defaults → <code class="docutils literal notranslate"><span class="pre">default=</span></code> parameter</p></li>
</ul>
</li>
<li><p><strong>Indexes</strong>:</p>
<ul class="simple">
<li><p>Django <code class="docutils literal notranslate"><span class="pre">db_index=True</span></code> → SQLAlchemy <code class="docutils literal notranslate"><span class="pre">index=True</span></code></p></li>
<li><p>Composite indexes → <code class="docutils literal notranslate"><span class="pre">__table_args__</span></code></p></li>
</ul>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="api-design">
<h2>API Design<a class="headerlink" href="#api-design" title="Link to this heading">¶</a></h2>
<section id="api-architecture">
<h3>API Architecture<a class="headerlink" href="#api-architecture" title="Link to this heading">¶</a></h3>
<p>The application provides two API versions:</p>
<ol class="arabic simple">
<li><p><strong>API v1</strong> (Legacy Compatibility): Tastypie-compatible endpoints</p></li>
<li><p><strong>API v2</strong> (Modern): RESTful with full OpenAPI documentation</p></li>
</ol>
</section>
<section id="api-v2-design-principles">
<h3>API v2 Design Principles<a class="headerlink" href="#api-v2-design-principles" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>RESTful Resource Design</strong></p></li>
<li><p><strong>Consistent Response Format</strong></p></li>
<li><p><strong>Pagination Built-in</strong></p></li>
<li><p><strong>Rate Limiting</strong></p></li>
<li><p><strong>OpenAPI Documentation</strong></p></li>
<li><p><strong>Versioning via URL Path</strong></p></li>
</ol>
</section>
<section id="response-format">
<h3>Response Format<a class="headerlink" href="#response-format" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Success Response</span>
</span><span data-line="2"><span class="p">{</span>
</span><span data-line="3">    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="4">    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="5">        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span data-line="6">        <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="7">        <span class="s2">&quot;page_size&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
</span><span data-line="8">        <span class="s2">&quot;has_next&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
</span><span data-line="9">        <span class="s2">&quot;has_previous&quot;</span><span class="p">:</span> <span class="n">false</span>
</span><span data-line="10">    <span class="p">}</span>
</span><span data-line="11"><span class="p">}</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Error Response</span>
</span><span data-line="14"><span class="p">{</span>
</span><span data-line="15">    <span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Error message&quot;</span><span class="p">,</span>
</span><span data-line="16">    <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
</span><span data-line="17">    <span class="s2">&quot;extra&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="18">        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Field-specific error&quot;</span><span class="p">]</span>
</span><span data-line="19">    <span class="p">}</span>
</span><span data-line="20"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="example-api-routes">
<h3>Example API Routes<a class="headerlink" href="#example-api-routes" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># api/v2/downloads.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">OffsetPagination</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">class</span><span class="w"> </span><span class="nc">DownloadAPIController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="7">    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/api/v2/downloads&quot;</span>
</span><span data-line="8">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;downloads&quot;</span><span class="p">]</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/releases&quot;</span><span class="p">)</span>
</span><span data-line="11">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_releases</span><span class="p">(</span>
</span><span data-line="12">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="13">        <span class="n">service</span><span class="p">:</span> <span class="n">ReleaseService</span><span class="p">,</span>
</span><span data-line="14">        <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="15">            <span class="n">query</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>
</span><span data-line="16">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Filter by Python version (1, 2, 3)&quot;</span>
</span><span data-line="17">        <span class="p">),</span>
</span><span data-line="18">        <span class="n">is_latest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="19">            <span class="n">query</span><span class="o">=</span><span class="s2">&quot;is_latest&quot;</span><span class="p">,</span>
</span><span data-line="20">            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Show only latest releases&quot;</span>
</span><span data-line="21">        <span class="p">),</span>
</span><span data-line="22">        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span data-line="23">        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span data-line="24">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">ReleaseRead</span><span class="p">]:</span>
</span><span data-line="25"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List Python releases with filtering.&quot;&quot;&quot;</span>
</span><span data-line="26">        <span class="n">releases</span> <span class="o">=</span> <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">list_releases</span><span class="p">(</span>
</span><span data-line="27">            <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
</span><span data-line="28">            <span class="n">is_latest</span><span class="o">=</span><span class="n">is_latest</span><span class="p">,</span>
</span><span data-line="29">            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span data-line="30">            <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
</span><span data-line="31">        <span class="p">)</span>
</span><span data-line="32">        <span class="k">return</span> <span class="n">OffsetPagination</span><span class="p">(</span>
</span><span data-line="33">            <span class="n">items</span><span class="o">=</span><span class="n">releases</span><span class="p">,</span>
</span><span data-line="34">            <span class="n">total</span><span class="o">=</span><span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">count_releases</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">is_latest</span><span class="p">),</span>
</span><span data-line="35">            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span data-line="36">            <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
</span><span data-line="37">        <span class="p">)</span>
</span><span data-line="38">
</span><span data-line="39">    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/releases/{release_slug:str}&quot;</span><span class="p">)</span>
</span><span data-line="40">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_release</span><span class="p">(</span>
</span><span data-line="41">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="42">        <span class="n">release_slug</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="43">        <span class="n">service</span><span class="p">:</span> <span class="n">ReleaseService</span>
</span><span data-line="44">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReleaseRead</span><span class="p">:</span>
</span><span data-line="45"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific release by slug.&quot;&quot;&quot;</span>
</span><span data-line="46">        <span class="n">release</span> <span class="o">=</span> <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">get_by_slug</span><span class="p">(</span><span class="n">release_slug</span><span class="p">)</span>
</span><span data-line="47">        <span class="k">if</span> <span class="ow">not</span> <span class="n">release</span><span class="p">:</span>
</span><span data-line="48">            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span><span class="s2">&quot;Release not found&quot;</span><span class="p">)</span>
</span><span data-line="49">        <span class="k">return</span> <span class="n">release</span>
</span><span data-line="50">
</span><span data-line="51">    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/releases/{release_slug:str}/files&quot;</span><span class="p">)</span>
</span><span data-line="52">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_release_files</span><span class="p">(</span>
</span><span data-line="53">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="54">        <span class="n">release_slug</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="55">        <span class="n">service</span><span class="p">:</span> <span class="n">ReleaseService</span><span class="p">,</span>
</span><span data-line="56">        <span class="n">os_slug</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="57">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ReleaseFileRead</span><span class="p">]:</span>
</span><span data-line="58"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List files for a release, optionally filtered by OS.&quot;&quot;&quot;</span>
</span><span data-line="59">        <span class="k">return</span> <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="n">release_slug</span><span class="p">,</span> <span class="n">os_slug</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="openapi-configuration">
<h3>OpenAPI Configuration<a class="headerlink" href="#openapi-configuration" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># config.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.openapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAPIConfig</span><span class="p">,</span> <span class="n">OpenAPIController</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.openapi.spec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contact</span><span class="p">,</span> <span class="n">License</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">openapi_config</span> <span class="o">=</span> <span class="n">OpenAPIConfig</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Python.org API&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2.0.0&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Official Python.org API for releases, events, jobs, and more&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">contact</span><span class="o">=</span><span class="n">Contact</span><span class="p">(</span>
</span><span data-line="10">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Python Software Foundation&quot;</span><span class="p">,</span>
</span><span data-line="11">        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.python.org&quot;</span><span class="p">,</span>
</span><span data-line="12">        <span class="n">email</span><span class="o">=</span><span class="s2">&quot;pydotorg-www@python.org&quot;</span>
</span><span data-line="13">    <span class="p">),</span>
</span><span data-line="14">    <span class="n">license</span><span class="o">=</span><span class="n">License</span><span class="p">(</span>
</span><span data-line="15">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Apache 2.0&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.apache.org/licenses/LICENSE-2.0.html&quot;</span>
</span><span data-line="17">    <span class="p">),</span>
</span><span data-line="18">    <span class="n">use_handler_docstrings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">tags</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="20">        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;downloads&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Python release downloads&quot;</span><span class="p">},</span>
</span><span data-line="21">        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Community events&quot;</span><span class="p">},</span>
</span><span data-line="22">        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Job board&quot;</span><span class="p">},</span>
</span><span data-line="23">        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;User management&quot;</span><span class="p">},</span>
</span><span data-line="24">    <span class="p">]</span>
</span><span data-line="25"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="authentication-authorization">
<h2>Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Link to this heading">¶</a></h2>
<section id="authentication-strategy">
<h3>Authentication Strategy<a class="headerlink" href="#authentication-strategy" title="Link to this heading">¶</a></h3>
<p><strong>Multi-Method Authentication</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Session-Based</strong> (Web UI): Traditional cookie sessions</p></li>
<li><p><strong>Token-Based</strong> (API): Bearer tokens for API access</p></li>
<li><p><strong>OAuth</strong> (Social): GitHub, Google, etc. via Allauth-equivalent</p></li>
</ol>
</section>
<section id="implementation-approach">
<h3>Implementation Approach<a class="headerlink" href="#implementation-approach" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># core/auth/models.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">ForeignKey</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">class</span><span class="w"> </span><span class="nc">AuthToken</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;API authentication tokens.&quot;&quot;&quot;</span>
</span><span data-line="7">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;auth_tokens&quot;</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="n">key</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="10">    <span class="n">user_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">))</span>
</span><span data-line="11">    <span class="n">created</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="n">user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">()</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># core/auth/guards.py</span>
</span><span data-line="16"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="17"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotAuthorizedException</span>
</span><span data-line="18"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
</span><span data-line="19">
</span><span data-line="20"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">session_auth_guard</span><span class="p">(</span>
</span><span data-line="21">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="22">    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="23"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="24"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Require authenticated session.&quot;&quot;&quot;</span>
</span><span data-line="25">    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span><span data-line="26">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_token_guard</span><span class="p">(</span>
</span><span data-line="29">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="30">    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="31"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="32"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Require valid API token.&quot;&quot;&quot;</span>
</span><span data-line="33">    <span class="n">auth_header</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35">    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Bearer &quot;</span><span class="p">):</span>
</span><span data-line="36">        <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Invalid authorization header&quot;</span><span class="p">)</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="n">token</span> <span class="o">=</span> <span class="n">auth_header</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
</span><span data-line="39">
</span><span data-line="40">    <span class="k">async</span> <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="41">        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span data-line="42">            <span class="n">select</span><span class="p">(</span><span class="n">AuthToken</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AuthToken</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">token</span><span class="p">)</span>
</span><span data-line="43">        <span class="p">)</span>
</span><span data-line="44">        <span class="n">auth_token</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span><span data-line="45">
</span><span data-line="46">        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_token</span><span class="p">:</span>
</span><span data-line="47">            <span class="k">raise</span> <span class="n">NotAuthorizedException</span><span class="p">(</span><span class="s2">&quot;Invalid token&quot;</span><span class="p">)</span>
</span><span data-line="48">
</span><span data-line="49">        <span class="n">connection</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">auth_token</span><span class="o">.</span><span class="n">user</span>
</span><span data-line="50">
</span><span data-line="51"><span class="c1"># core/auth/middleware.py</span>
</span><span data-line="52"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractAuthenticationMiddleware</span>
</span><span data-line="53"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="54">
</span><span data-line="55"><span class="k">class</span><span class="w"> </span><span class="nc">SessionAuthMiddleware</span><span class="p">(</span><span class="n">AbstractAuthenticationMiddleware</span><span class="p">):</span>
</span><span data-line="56"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load user from session.&quot;&quot;&quot;</span>
</span><span data-line="57">
</span><span data-line="58">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_request</span><span class="p">(</span>
</span><span data-line="59">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="60">        <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span>
</span><span data-line="61">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="62">        <span class="n">session_id</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_id&quot;</span><span class="p">)</span>
</span><span data-line="63">
</span><span data-line="64">        <span class="k">if</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
</span><span data-line="65">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="66">
</span><span data-line="67">        <span class="c1"># Load user from session store (Redis)</span>
</span><span data-line="68">        <span class="n">user_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">session_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span data-line="69">
</span><span data-line="70">        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
</span><span data-line="71">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="72">
</span><span data-line="73">        <span class="k">async</span> <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="74">            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span data-line="75">                <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">)</span>
</span><span data-line="76">            <span class="p">)</span>
</span><span data-line="77">            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="authorization-patterns">
<h3>Authorization Patterns<a class="headerlink" href="#authorization-patterns" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># lib/guards/permissions.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ASGIConnection</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PermissionDeniedException</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">class</span><span class="w"> </span><span class="nc">Permission</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
</span><span data-line="7">    <span class="n">JOB_MODERATE</span> <span class="o">=</span> <span class="s2">&quot;jobs.can_moderate_jobs&quot;</span>
</span><span data-line="8">    <span class="n">PAGE_EDIT</span> <span class="o">=</span> <span class="s2">&quot;pages.can_edit_pages&quot;</span>
</span><span data-line="9">    <span class="n">RELEASE_PUBLISH</span> <span class="o">=</span> <span class="s2">&quot;downloads.can_publish_releases&quot;</span>
</span><span data-line="10">
</span><span data-line="11"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">requires_permission</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">permission</span><span class="p">:</span> <span class="n">Permission</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">connection</span><span class="p">:</span> <span class="n">ASGIConnection</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="15"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="16"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if user has specific permission.&quot;&quot;&quot;</span>
</span><span data-line="17">    <span class="n">user</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">user</span>
</span><span data-line="18">
</span><span data-line="19">    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span data-line="20">        <span class="k">raise</span> <span class="n">PermissionDeniedException</span><span class="p">(</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
</span><span data-line="23">        <span class="k">return</span>
</span><span data-line="24">
</span><span data-line="25">    <span class="c1"># Check user permissions (implement based on needs)</span>
</span><span data-line="26">    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">permission</span><span class="p">):</span>
</span><span data-line="27">        <span class="k">raise</span> <span class="n">PermissionDeniedException</span><span class="p">(</span>
</span><span data-line="28">            <span class="sa">f</span><span class="s2">&quot;Missing required permission: </span><span class="si">{</span><span class="n">permission</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="29">        <span class="p">)</span>
</span><span data-line="30">
</span><span data-line="31"><span class="c1"># Usage in controller</span>
</span><span data-line="32"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
</span><span data-line="33">
</span><span data-line="34"><span class="k">class</span><span class="w"> </span><span class="nc">JobController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="35">    <span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/jobs/{job_id:int}/approve&quot;</span><span class="p">)</span>
</span><span data-line="36">    <span class="nd">@requires_permission</span><span class="p">(</span><span class="n">Permission</span><span class="o">.</span><span class="n">JOB_MODERATE</span><span class="p">)</span>
</span><span data-line="37">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">approve_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobRead</span><span class="p">:</span>
</span><span data-line="38">        <span class="o">...</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="configuration-management">
<h2>Configuration Management<a class="headerlink" href="#configuration-management" title="Link to this heading">¶</a></h2>
<section id="environment-based-configuration">
<h3>Environment-Based Configuration<a class="headerlink" href="#environment-based-configuration" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># config.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">PostgresDsn</span><span class="p">,</span> <span class="n">RedisDsn</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Application settings loaded from environment.&quot;&quot;&quot;</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
</span><span data-line="12">        <span class="n">env_file</span><span class="o">=</span><span class="s2">&quot;.env&quot;</span><span class="p">,</span>
</span><span data-line="13">        <span class="n">env_file_encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span data-line="14">        <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="15">        <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
</span><span data-line="16">    <span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="c1"># Environment</span>
</span><span data-line="19">    <span class="n">environment</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="s2">&quot;staging&quot;</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span>
</span><span data-line="20">    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># Application</span>
</span><span data-line="23">    <span class="n">site_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Python.org&quot;</span>
</span><span data-line="24">    <span class="n">site_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;The official home of the Python Programming Language&quot;</span>
</span><span data-line="25">    <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="c1"># Database</span>
</span><span data-line="28">    <span class="n">database_url</span><span class="p">:</span> <span class="n">PostgresDsn</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span data-line="29">        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;postgresql+asyncpg://postgres:postgres@localhost:5432/pythondotorg&quot;</span>
</span><span data-line="30">    <span class="p">)</span>
</span><span data-line="31">    <span class="n">database_echo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="32">    <span class="n">database_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
</span><span data-line="33">    <span class="n">database_max_overflow</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span data-line="34">
</span><span data-line="35">    <span class="c1"># Redis</span>
</span><span data-line="36">    <span class="n">redis_url</span><span class="p">:</span> <span class="n">RedisDsn</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;redis://localhost:6379/0&quot;</span><span class="p">)</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="c1"># Cache</span>
</span><span data-line="39">    <span class="n">cache_ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="c1"># Session</span>
</span><span data-line="42">    <span class="n">session_cookie_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pydotorg_session&quot;</span>
</span><span data-line="43">    <span class="n">session_lifetime</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">86400</span> <span class="o">*</span> <span class="mi">14</span>  <span class="c1"># 14 days</span>
</span><span data-line="44">
</span><span data-line="45">    <span class="c1"># Email</span>
</span><span data-line="46">    <span class="n">email_backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;smtp&quot;</span>
</span><span data-line="47">    <span class="n">email_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
</span><span data-line="48">    <span class="n">email_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">587</span>
</span><span data-line="49">    <span class="n">email_use_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="50">    <span class="n">email_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="51">    <span class="n">email_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="52">    <span class="n">default_from_email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noreply@python.org&quot;</span>
</span><span data-line="53">
</span><span data-line="54">    <span class="c1"># Background Tasks</span>
</span><span data-line="55">    <span class="n">saq_queue_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pydotorg&quot;</span>
</span><span data-line="56">
</span><span data-line="57">    <span class="c1"># CDN</span>
</span><span data-line="58">    <span class="n">fastly_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="59">    <span class="n">fastly_service_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="60">
</span><span data-line="61">    <span class="c1"># Static Files</span>
</span><span data-line="62">    <span class="n">static_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/static/&quot;</span>
</span><span data-line="63">    <span class="n">media_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/media/&quot;</span>
</span><span data-line="64">    <span class="n">static_root</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;static-root&quot;</span><span class="p">)</span>
</span><span data-line="65">    <span class="n">media_root</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;media&quot;</span><span class="p">)</span>
</span><span data-line="66">
</span><span data-line="67">    <span class="c1"># Search</span>
</span><span data-line="68">    <span class="n">meilisearch_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:7700&quot;</span>
</span><span data-line="69">    <span class="n">meilisearch_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="70">
</span><span data-line="71">    <span class="c1"># Jobs</span>
</span><span data-line="72">    <span class="n">job_threshold_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">90</span>
</span><span data-line="73">    <span class="n">job_from_email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;jobs@python.org&quot;</span>
</span><span data-line="74">
</span><span data-line="75">    <span class="c1"># Events</span>
</span><span data-line="76">    <span class="n">events_to_email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;events@python.org&quot;</span>
</span><span data-line="77">
</span><span data-line="78">    <span class="c1"># Sponsors</span>
</span><span data-line="79">    <span class="n">sponsorship_notification_from_email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sponsors@python.org&quot;</span>
</span><span data-line="80">    <span class="n">sponsorship_notification_to_email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;psf-sponsors@python.org&quot;</span>
</span><span data-line="81">
</span><span data-line="82">    <span class="c1"># Rate Limiting</span>
</span><span data-line="83">    <span class="n">rate_limit_anonymous</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100/day&quot;</span>
</span><span data-line="84">    <span class="n">rate_limit_authenticated</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3000/day&quot;</span>
</span><span data-line="85">
</span><span data-line="86">    <span class="c1"># Logging</span>
</span><span data-line="87">    <span class="n">log_level</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
</span><span data-line="88">
</span><span data-line="89">    <span class="nd">@property</span>
</span><span data-line="90">    <span class="k">def</span><span class="w"> </span><span class="nf">is_production</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="91">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span>
</span><span data-line="92">
</span><span data-line="93">    <span class="nd">@property</span>
</span><span data-line="94">    <span class="k">def</span><span class="w"> </span><span class="nf">is_development</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="95">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">==</span> <span class="s2">&quot;development&quot;</span>
</span><span data-line="96">
</span><span data-line="97"><span class="nd">@lru_cache</span>
</span><span data-line="98"><span class="k">def</span><span class="w"> </span><span class="nf">get_settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Settings</span><span class="p">:</span>
</span><span data-line="99"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cached settings instance.&quot;&quot;&quot;</span>
</span><span data-line="100">    <span class="k">return</span> <span class="n">Settings</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="environment-files">
<h3>Environment Files<a class="headerlink" href="#environment-files" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># .env.example</span>
</span><span data-line="2"><span class="nv">ENVIRONMENT</span><span class="o">=</span>development
</span><span data-line="3"><span class="nv">DEBUG</span><span class="o">=</span><span class="nb">true</span>
</span><span data-line="4"><span class="nv">SECRET_KEY</span><span class="o">=</span>your-secret-key-min-32-chars-long
</span><span data-line="5">
</span><span data-line="6"><span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql+asyncpg://postgres:postgres@localhost:5432/pythondotorg
</span><span data-line="7"><span class="nv">REDIS_URL</span><span class="o">=</span>redis://localhost:6379/0
</span><span data-line="8">
</span><span data-line="9"><span class="nv">EMAIL_HOST</span><span class="o">=</span>smtp.sendgrid.net
</span><span data-line="10"><span class="nv">EMAIL_USERNAME</span><span class="o">=</span>apikey
</span><span data-line="11"><span class="nv">EMAIL_PASSWORD</span><span class="o">=</span>your-sendgrid-api-key
</span><span data-line="12">
</span><span data-line="13"><span class="nv">FASTLY_API_KEY</span><span class="o">=</span>
</span><span data-line="14"><span class="nv">FASTLY_SERVICE_ID</span><span class="o">=</span>
</span><span data-line="15">
</span><span data-line="16"><span class="nv">MEILISEARCH_URL</span><span class="o">=</span>http://localhost:7700
</span><span data-line="17"><span class="nv">MEILISEARCH_API_KEY</span><span class="o">=</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="background-tasks">
<h2>Background Tasks<a class="headerlink" href="#background-tasks" title="Link to this heading">¶</a></h2>
<section id="saq-integration">
<h3>SAQ Integration<a class="headerlink" href="#saq-integration" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># tasks/base.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">saq</span><span class="w"> </span><span class="kn">import</span> <span class="n">Queue</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">saq.worker</span><span class="w"> </span><span class="kn">import</span> <span class="n">Worker</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">redis.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">Redis</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">pydotorg.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_settings</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Create Redis connection</span>
</span><span data-line="11"><span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">redis_url</span><span class="p">))</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Create queue</span>
</span><span data-line="14"><span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">redis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">saq_queue_name</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Define worker</span>
</span><span data-line="17"><span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span>
</span><span data-line="18">    <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">functions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="20">        <span class="c1"># Register all task functions here</span>
</span><span data-line="21">    <span class="p">],</span>
</span><span data-line="22">    <span class="n">concurrency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="23"><span class="p">)</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1"># tasks/downloads.py</span>
</span><span data-line="26"><span class="kn">from</span><span class="w"> </span><span class="nn">saq</span><span class="w"> </span><span class="kn">import</span> <span class="n">Job</span>
</span><span data-line="27"><span class="kn">from</span><span class="w"> </span><span class="nn">pydotorg.domains.downloads.services</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReleaseService</span>
</span><span data-line="28"><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">queue</span>
</span><span data-line="29">
</span><span data-line="30"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_download_boxes</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="31"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update homepage and download page boxes.&quot;&quot;&quot;</span>
</span><span data-line="32">    <span class="k">async</span> <span class="k">with</span> <span class="n">get_db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="33">        <span class="n">service</span> <span class="o">=</span> <span class="n">ReleaseService</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="34">        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">update_download_boxes</span><span class="p">()</span>
</span><span data-line="35">
</span><span data-line="36"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">purge_download_cache</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">release_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="37"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Purge Fastly cache for download pages.&quot;&quot;&quot;</span>
</span><span data-line="38">    <span class="k">async</span> <span class="k">with</span> <span class="n">get_db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="39">        <span class="n">service</span> <span class="o">=</span> <span class="n">ReleaseService</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="40">        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">purge_cache</span><span class="p">(</span><span class="n">release_id</span><span class="p">)</span>
</span><span data-line="41">
</span><span data-line="42"><span class="c1"># Schedule tasks</span>
</span><span data-line="43"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">schedule_update_boxes</span><span class="p">():</span>
</span><span data-line="44"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Schedule periodic box updates.&quot;&quot;&quot;</span>
</span><span data-line="45">    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span>
</span><span data-line="46">        <span class="s2">&quot;update_download_boxes&quot;</span><span class="p">,</span>
</span><span data-line="47">        <span class="n">scheduled</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="mi">3600</span>  <span class="c1"># 1 hour from now</span>
</span><span data-line="48">    <span class="p">)</span>
</span><span data-line="49">
</span><span data-line="50"><span class="c1"># tasks/events.py</span>
</span><span data-line="51"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">import_calendar_events</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">calendar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="52"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Import events from iCal feed.&quot;&quot;&quot;</span>
</span><span data-line="53">    <span class="k">async</span> <span class="k">with</span> <span class="n">get_db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="54">        <span class="kn">from</span><span class="w"> </span><span class="nn">pydotorg.domains.events.importer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ICSImporter</span>
</span><span data-line="55">
</span><span data-line="56">        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span data-line="57">            <span class="n">select</span><span class="p">(</span><span class="n">Calendar</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Calendar</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">calendar_id</span><span class="p">)</span>
</span><span data-line="58">        <span class="p">)</span>
</span><span data-line="59">        <span class="n">calendar</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span>
</span><span data-line="60">
</span><span data-line="61">        <span class="n">importer</span> <span class="o">=</span> <span class="n">ICSImporter</span><span class="p">(</span><span class="n">calendar</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
</span><span data-line="62">        <span class="k">await</span> <span class="n">importer</span><span class="o">.</span><span class="n">import_events</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="task-scheduling">
<h3>Task Scheduling<a class="headerlink" href="#task-scheduling" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># main.py - Application startup</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">saq.cron</span><span class="w"> </span><span class="kn">import</span> <span class="n">cron</span>
</span><span data-line="3">
</span><span data-line="4"><span class="nd">@app</span><span class="o">.</span><span class="n">on_startup</span>
</span><span data-line="5"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_task_worker</span><span class="p">():</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Start background task worker.&quot;&quot;&quot;</span>
</span><span data-line="7">    <span class="c1"># Schedule periodic tasks</span>
</span><span data-line="8">    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
</span><span data-line="9">        <span class="s2">&quot;update_download_boxes&quot;</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">cron</span><span class="o">=</span><span class="s2">&quot;0 */6 * * *&quot;</span><span class="p">,</span>  <span class="c1"># Every 6 hours</span>
</span><span data-line="11">    <span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
</span><span data-line="14">        <span class="s2">&quot;cleanup_expired_jobs&quot;</span><span class="p">,</span>
</span><span data-line="15">        <span class="n">cron</span><span class="o">=</span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>  <span class="c1"># Daily at midnight</span>
</span><span data-line="16">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="migration-strategy">
<h2>Migration Strategy<a class="headerlink" href="#migration-strategy" title="Link to this heading">¶</a></h2>
<section id="phase-1-foundation-weeks-1-2">
<h3>Phase 1: Foundation (Weeks 1-2)<a class="headerlink" href="#phase-1-foundation-weeks-1-2" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Set up project structure and core infrastructure</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Initialize project with uv</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Configure Litestar application</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Set up SQLAlchemy with async support</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Configure Alembic migrations</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Implement base models and mixins</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Set up testing framework</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Configure CI/CD pipeline</p></li>
</ul>
</section>
<section id="phase-2-core-domains-weeks-3-5">
<h3>Phase 2: Core Domains (Weeks 3-5)<a class="headerlink" href="#phase-2-core-domains-weeks-3-5" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Migrate essential domains</p>
<p>Priority Order:</p>
<ol class="arabic simple">
<li><p><strong>Users Domain</strong> (authentication foundation)</p></li>
<li><p><strong>CMS Domain</strong> (base mixins and patterns)</p></li>
<li><p><strong>Pages Domain</strong> (core content)</p></li>
<li><p><strong>Downloads Domain</strong> (critical functionality)</p></li>
</ol>
<p>For each domain:</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Create SQLAlchemy models</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Write Alembic migrations</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Define Pydantic schemas</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Implement services layer</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Build controllers</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Write unit tests</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Create integration tests</p></li>
</ul>
</section>
<section id="phase-3-feature-domains-weeks-6-9">
<h3>Phase 3: Feature Domains (Weeks 6-9)<a class="headerlink" href="#phase-3-feature-domains-weeks-6-9" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Migrate remaining domains</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Events</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Jobs</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Community</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Sponsors</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Blogs</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Boxes</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Banners</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Success Stories</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Nominations</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Minutes</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Work Groups</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Companies</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Code Samples</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Mailing</p></li>
</ul>
</section>
<section id="phase-4-templates-frontend-weeks-10-11">
<h3>Phase 4: Templates &amp; Frontend (Weeks 10-11)<a class="headerlink" href="#phase-4-templates-frontend-weeks-10-11" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Port Django templates to Jinja2</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Convert base templates</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Implement template context processors</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Port domain-specific templates</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Integrate static asset pipeline</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Test responsive layouts</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Accessibility audit</p></li>
</ul>
</section>
<section id="phase-5-background-tasks-integration-week-12">
<h3>Phase 5: Background Tasks &amp; Integration (Week 12)<a class="headerlink" href="#phase-5-background-tasks-integration-week-12" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Implement async tasks and integrations</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Set up SAQ task queue</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Port Celery tasks to SAQ</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Integrate Meilisearch</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Configure Fastly cache purging</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Email delivery setup</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> OAuth provider integration</p></li>
</ul>
</section>
<section id="phase-6-testing-optimization-weeks-13-14">
<h3>Phase 6: Testing &amp; Optimization (Weeks 13-14)<a class="headerlink" href="#phase-6-testing-optimization-weeks-13-14" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Ensure quality and performance</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> End-to-end testing</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Performance benchmarking</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Load testing</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Security audit</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Database query optimization</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Cache strategy tuning</p></li>
</ul>
</section>
<section id="phase-7-deployment-cutover-weeks-15-16">
<h3>Phase 7: Deployment &amp; Cutover (Weeks 15-16)<a class="headerlink" href="#phase-7-deployment-cutover-weeks-15-16" title="Link to this heading">¶</a></h3>
<p><strong>Goal</strong>: Production deployment</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Staging environment deployment</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Data migration from Django</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Smoke testing in staging</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Performance monitoring setup</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Production deployment</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> DNS cutover</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Post-deployment monitoring</p></li>
</ul>
</section>
<section id="data-migration-script">
<h3>Data Migration Script<a class="headerlink" href="#data-migration-script" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># scripts/import_django_data.py</span>
</span><span data-line="2"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="3"><span class="sd">Import data from Django database to Litestar database.</span>
</span><span data-line="4">
</span><span data-line="5"><span class="sd">Usage:</span>
</span><span data-line="6"><span class="sd">    uv run python scripts/import_django_data.py --django-db postgresql://... --litestar-db postgresql://...</span>
</span><span data-line="7"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="8"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="9"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">select</span>
</span><span data-line="10"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span><span class="p">,</span> <span class="n">AsyncSession</span>
</span><span data-line="11">
</span><span data-line="12"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">migrate_users</span><span class="p">(</span><span class="n">django_conn</span><span class="p">,</span> <span class="n">litestar_session</span><span class="p">):</span>
</span><span data-line="13"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Migrate users from Django to Litestar.&quot;&quot;&quot;</span>
</span><span data-line="14">    <span class="c1"># Read from Django</span>
</span><span data-line="15">    <span class="n">django_users</span> <span class="o">=</span> <span class="n">django_conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span data-line="16">        <span class="s2">&quot;SELECT * FROM auth_user&quot;</span>
</span><span data-line="17">    <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span data-line="18">
</span><span data-line="19">    <span class="c1"># Transform and insert into Litestar</span>
</span><span data-line="20">    <span class="k">for</span> <span class="n">du</span> <span class="ow">in</span> <span class="n">django_users</span><span class="p">:</span>
</span><span data-line="21">        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span>
</span><span data-line="22">            <span class="nb">id</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span data-line="23">            <span class="n">username</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span data-line="24">            <span class="n">email</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
</span><span data-line="25">            <span class="n">password_hash</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>  <span class="c1"># Keep Django password hashes</span>
</span><span data-line="26">            <span class="n">first_name</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
</span><span data-line="27">            <span class="n">last_name</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
</span><span data-line="28">            <span class="n">is_active</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">is_active</span><span class="p">,</span>
</span><span data-line="29">            <span class="n">is_staff</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">is_staff</span><span class="p">,</span>
</span><span data-line="30">            <span class="n">is_superuser</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">,</span>
</span><span data-line="31">            <span class="n">created</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">date_joined</span><span class="p">,</span>
</span><span data-line="32">        <span class="p">)</span>
</span><span data-line="33">        <span class="n">litestar_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35">    <span class="k">await</span> <span class="n">litestar_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="36">
</span><span data-line="37"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="38">    <span class="c1"># Connect to both databases</span>
</span><span data-line="39">    <span class="n">django_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://...&quot;</span><span class="p">)</span>
</span><span data-line="40">    <span class="n">litestar_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://...&quot;</span><span class="p">)</span>
</span><span data-line="41">
</span><span data-line="42">    <span class="k">with</span> <span class="n">django_engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">django_conn</span><span class="p">:</span>
</span><span data-line="43">        <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncSession</span><span class="p">(</span><span class="n">litestar_engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="44">            <span class="k">await</span> <span class="n">migrate_users</span><span class="p">(</span><span class="n">django_conn</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
</span><span data-line="45">            <span class="k">await</span> <span class="n">migrate_pages</span><span class="p">(</span><span class="n">django_conn</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
</span><span data-line="46">            <span class="k">await</span> <span class="n">migrate_releases</span><span class="p">(</span><span class="n">django_conn</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
</span><span data-line="47">            <span class="c1"># ... continue for all domains</span>
</span><span data-line="48">
</span><span data-line="49"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span data-line="50">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<section id="database-optimization">
<h3>Database Optimization<a class="headerlink" href="#database-optimization" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p><strong>Connection Pooling</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">settings</span><span class="o">.</span><span class="n">database_url</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">pool_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">max_overflow</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">pool_pre_ping</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">echo</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">database_echo</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</li>
<li><p><strong>Query Optimization</strong>:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">selectinload()</span></code> for relationships</p></li>
<li><p>Implement pagination for large result sets</p></li>
<li><p>Add indexes for common query patterns</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">defer()</span></code> for large text fields</p></li>
</ul>
</li>
<li><p><strong>Caching Strategy</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># core/cache/decorator.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">def</span><span class="w"> </span><span class="nf">cache_result</span><span class="p">(</span><span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">):</span>
</span><span data-line="6">    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
</span><span data-line="7">        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span data-line="8">        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="9">            <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="10">
</span><span data-line="11">            <span class="c1"># Try cache first</span>
</span><span data-line="12">            <span class="n">cached</span> <span class="o">=</span> <span class="k">await</span> <span class="n">redis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
</span><span data-line="13">            <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
</span><span data-line="14">                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16">            <span class="c1"># Execute function</span>
</span><span data-line="17">            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19">            <span class="c1"># Store in cache</span>
</span><span data-line="20">            <span class="k">await</span> <span class="n">redis</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span>
</span><span data-line="21">                <span class="n">cache_key</span><span class="p">,</span>
</span><span data-line="22">                <span class="n">ttl</span><span class="p">,</span>
</span><span data-line="23">                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</span><span data-line="24">            <span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26">            <span class="k">return</span> <span class="n">result</span>
</span><span data-line="27">        <span class="k">return</span> <span class="n">wrapper</span>
</span><span data-line="28">    <span class="k">return</span> <span class="n">decorator</span>
</span></pre></div>
</div>
</li>
</ol>
</section>
<section id="response-optimization">
<h3>Response Optimization<a class="headerlink" href="#response-optimization" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Compression</strong>: Enable gzip compression</p></li>
<li><p><strong>ETags</strong>: Implement ETags for static content</p></li>
<li><p><strong>CDN</strong>: Leverage Fastly for static assets and page caching</p></li>
</ol>
</section>
<section id="async-best-practices">
<h3>Async Best Practices<a class="headerlink" href="#async-best-practices" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Non-blocking I/O</strong>: Use <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> for all I/O operations</p></li>
<li><p><strong>Task Concurrency</strong>: Use <code class="docutils literal notranslate"><span class="pre">asyncio.gather()</span></code> for parallel tasks</p></li>
<li><p><strong>Connection Limits</strong>: Configure appropriate pool sizes</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="security-architecture">
<h2>Security Architecture<a class="headerlink" href="#security-architecture" title="Link to this heading">¶</a></h2>
<section id="security-principles">
<h3>Security Principles<a class="headerlink" href="#security-principles" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Defense in Depth</strong></p></li>
<li><p><strong>Least Privilege</strong></p></li>
<li><p><strong>Secure by Default</strong></p></li>
<li><p><strong>Input Validation</strong></p></li>
<li><p><strong>Output Encoding</strong></p></li>
</ol>
</section>
<section id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># core/security/middleware.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefineMiddleware</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.security.session_auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionAuth</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">security_config</span> <span class="o">=</span> <span class="n">SessionAuth</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">secret</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">cookie_name</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">session_cookie_name</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">cookie_httponly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">cookie_secure</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">is_production</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">cookie_samesite</span><span class="o">=</span><span class="s2">&quot;lax&quot;</span><span class="p">,</span>
</span><span data-line="11"><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># CORS configuration</span>
</span><span data-line="14"><span class="n">cors_config</span> <span class="o">=</span> <span class="n">CORSConfig</span><span class="p">(</span>
</span><span data-line="15">    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;https://www.python.org&quot;</span><span class="p">],</span>
</span><span data-line="16">    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">],</span>
</span><span data-line="17">    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
</span><span data-line="18">    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="19"><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># CSP headers</span>
</span><span data-line="22"><span class="n">csp_middleware</span> <span class="o">=</span> <span class="n">DefineMiddleware</span><span class="p">(</span>
</span><span data-line="23">    <span class="n">CSPMiddleware</span><span class="p">,</span>
</span><span data-line="24">    <span class="n">policy</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="25">        <span class="s2">&quot;default-src&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">],</span>
</span><span data-line="26">        <span class="s2">&quot;script-src&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;unsafe-inline&#39;&quot;</span><span class="p">],</span>
</span><span data-line="27">        <span class="s2">&quot;style-src&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;unsafe-inline&#39;&quot;</span><span class="p">],</span>
</span><span data-line="28">        <span class="s2">&quot;img-src&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;data:&quot;</span><span class="p">,</span> <span class="s2">&quot;https:&quot;</span><span class="p">],</span>
</span><span data-line="29">    <span class="p">}</span>
</span><span data-line="30"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="input-validation">
<h3>Input Validation<a class="headerlink" href="#input-validation" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># All input validated via Pydantic</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">JobCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">job_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span data-line="4">    <span class="n">company_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span data-line="5">    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span>
</span><span data-line="6">    <span class="n">url</span><span class="p">:</span> <span class="n">HttpUrl</span>
</span><span data-line="7">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
</span><span data-line="10">    <span class="nd">@classmethod</span>
</span><span data-line="11">    <span class="k">def</span><span class="w"> </span><span class="nf">sanitize_html</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="12"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Strip dangerous HTML tags.&quot;&quot;&quot;</span>
</span><span data-line="13">        <span class="k">return</span> <span class="n">bleach</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span>
</span><span data-line="14">            <span class="n">v</span><span class="p">,</span>
</span><span data-line="15">            <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;br&#39;</span><span class="p">,</span> <span class="s1">&#39;strong&#39;</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">,</span> <span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="s1">&#39;ol&#39;</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">],</span>
</span><span data-line="16">            <span class="n">strip</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="17">        <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="rate-limiting">
<h3>Rate Limiting<a class="headerlink" href="#rate-limiting" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># core/middleware/rate_limit.py</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.rate_limit</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimitConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">rate_limit_config</span> <span class="o">=</span> <span class="n">RateLimitConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">rate_limit</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;100&quot;</span><span class="p">,</span> <span class="s2">&quot;minute&quot;</span><span class="p">),</span>
</span><span data-line="6">    <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/health&quot;</span><span class="p">,</span> <span class="s2">&quot;/static/*&quot;</span><span class="p">],</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="appendices">
<h2>Appendices<a class="headerlink" href="#appendices" title="Link to this heading">¶</a></h2>
<section id="a-technology-decision-records">
<h3>A. Technology Decision Records<a class="headerlink" href="#a-technology-decision-records" title="Link to this heading">¶</a></h3>
<section id="adr-001-litestar-over-fastapi">
<h4>ADR-001: Litestar over FastAPI<a class="headerlink" href="#adr-001-litestar-over-fastapi" title="Link to this heading">¶</a></h4>
<p><strong>Decision</strong>: Use Litestar 2.x as the web framework</p>
<p><strong>Rationale</strong>:</p>
<ul class="simple">
<li><p>Superior dependency injection system</p></li>
<li><p>Better integration with SQLAlchemy</p></li>
<li><p>Advanced Alchemy provides excellent database utilities</p></li>
<li><p>Strong type safety enforcement</p></li>
<li><p>Excellent OpenAPI documentation</p></li>
<li><p>Active development and community</p></li>
</ul>
<p><strong>Alternatives Considered</strong>:</p>
<ul class="simple">
<li><p>FastAPI: Good but less integrated ecosystem</p></li>
<li><p>Starlette: Too low-level, more boilerplate needed</p></li>
</ul>
</section>
<section id="adr-002-saq-over-celery">
<h4>ADR-002: SAQ over Celery<a class="headerlink" href="#adr-002-saq-over-celery" title="Link to this heading">¶</a></h4>
<p><strong>Decision</strong>: Use SAQ for background tasks</p>
<p><strong>Rationale</strong>:</p>
<ul class="simple">
<li><p>Native async support</p></li>
<li><p>Simpler configuration</p></li>
<li><p>Better performance for async tasks</p></li>
<li><p>Redis-native (already in stack)</p></li>
<li><p>Lighter weight</p></li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul class="simple">
<li><p>Less mature than Celery</p></li>
<li><p>Smaller community</p></li>
<li><p>Fewer integrations</p></li>
</ul>
</section>
<section id="adr-003-meilisearch-over-elasticsearch">
<h4>ADR-003: Meilisearch over Elasticsearch<a class="headerlink" href="#adr-003-meilisearch-over-elasticsearch" title="Link to this heading">¶</a></h4>
<p><strong>Decision</strong>: Use Meilisearch for search functionality</p>
<p><strong>Rationale</strong>:</p>
<ul class="simple">
<li><p>Simpler deployment</p></li>
<li><p>Better out-of-box relevance</p></li>
<li><p>Lower resource usage</p></li>
<li><p>Easier to maintain</p></li>
<li><p>Good Python client</p></li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul class="simple">
<li><p>Less flexible than Elasticsearch</p></li>
<li><p>Smaller feature set</p></li>
</ul>
</section>
</section>
<section id="b-file-templates">
<h3>B. File Templates<a class="headerlink" href="#b-file-templates" title="Link to this heading">¶</a></h3>
<p>See <code class="docutils literal notranslate"><span class="pre">/docs/architecture/templates/</span></code> for:</p>
<ul class="simple">
<li><p>Model template</p></li>
<li><p>Controller template</p></li>
<li><p>Service template</p></li>
<li><p>Schema template</p></li>
<li><p>Test template</p></li>
</ul>
</section>
<section id="c-development-guidelines">
<h3>C. Development Guidelines<a class="headerlink" href="#c-development-guidelines" title="Link to this heading">¶</a></h3>
<p>See <code class="docutils literal notranslate"><span class="pre">/docs/architecture/DEVELOPMENT.md</span></code> for:</p>
<ul class="simple">
<li><p>Code style guide</p></li>
<li><p>Testing standards</p></li>
<li><p>Git workflow</p></li>
<li><p>PR review process</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="revision-history">
<h2>Revision History<a class="headerlink" href="#revision-history" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Author</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.0</p></td>
<td><p>2025-11-25</p></td>
<td><p>ARCHITECT Agent</p></td>
<td><p>Initial architecture document</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<hr class="docutils" />
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.litestar.dev/">Litestar Documentation</a></p></li>
<li><p><a class="reference external" href="https://docs.sqlalchemy.org/">SQLAlchemy 2.0 Documentation</a></p></li>
<li><p><a class="reference external" href="https://docs.advanced-alchemy.litestar.dev/">Advanced Alchemy</a></p></li>
<li><p><a class="reference external" href="https://docs.pydantic.dev/">Pydantic V2</a></p></li>
<li><p><a class="reference external" href="https://saq-py.readthedocs.io/">SAQ Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/python/pythondotorg">Django pythondotorg Repository</a></p></li>
</ul>
<hr class="docutils" />
<p><strong>Document Path</strong>: <code class="docutils literal notranslate"><span class="pre">/Users/coffee/git/public/JacobCoffee/litestar-pydotorg/docs/architecture/ARCHITECTURE.md</span></code></p>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="index.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Architecture</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="DATABASE_SCHEMA.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Database Schema Design</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/litestar-pydotorg" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>