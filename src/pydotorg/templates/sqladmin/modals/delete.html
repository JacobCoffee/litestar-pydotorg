<dialog id="deleteModal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg text-error">Confirm Delete</h3>
        <p class="py-4">Are you sure you want to delete this item? This action cannot be undone.</p>
        <form id="delete-form" method="post">
            <div class="modal-action">
                <button type="button" class="btn btn-ghost" onclick="deleteModal.close()">Cancel</button>
                <button type="submit" class="btn btn-error gap-2">
                    <i data-lucide="trash-2" class="h-4 w-4"></i>
                    Delete
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<script>
document.addEventListener('click', function(e) {
    const target = e.target.closest('[data-url]');
    if (target && (target.id === 'action-delete' || target.closest('button[title="Delete"]') || target.closest('button[data-url]'))) {
        const url = target.getAttribute('data-url');
        const pk = target.getAttribute('data-pk');
        const form = document.getElementById('delete-form');
        if (pk) {
            form.action = url;
        } else {
            const selectedItems = document.querySelectorAll('.select-box:checked');
            if (selectedItems.length === 0) {
                e.preventDefault();
                alert('Please select at least one item to delete.');
                return;
            }
            form.action = url;
            selectedItems.forEach(item => {
                const hiddenInput = item.closest('tr').querySelector('input[type="hidden"]');
                if (hiddenInput) {
                    const pkInput = document.createElement('input');
                    pkInput.type = 'hidden';
                    pkInput.name = 'pks';
                    pkInput.value = hiddenInput.value;
                    form.appendChild(pkInput);
                }
            });
        }
    }
});
</script>
