<!DOCTYPE html>
<html lang="en" data-theme="python" x-data="{ darkMode: false }" :data-theme="darkMode ? 'pythondark' : 'python'">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>{% block title %}Python.org{% endblock %}</title>

    <meta name="description" content="{% block meta_description %}The official home of the Python Programming Language{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}Python, programming, development, code{% endblock %}">

    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:image" content="{% block og_image %}/static/images/python-logo-og.png{% endblock %}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ThePSF">

    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png">

    {# TailwindCSS + DaisyUI #}
    <link rel="stylesheet" href="/static/css/tailwind.css">

    {# HTMX Configuration #}
    <meta name="htmx-config" content='{"defaultSwapStyle":"innerHTML","historyCacheSize":10}'>

    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col bg-base-100" hx-boost="true">
    {# Skip to content link for accessibility #}
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-primary focus:text-primary-content">
        Skip to main content
    </a>

    {# Navigation #}
    {% block navbar %}
    {% include 'partials/navbar.html.jinja2' %}
    {% endblock %}

    {# Main Content #}
    <main id="main-content" class="flex-grow">
        {# Breadcrumbs #}
        {% block breadcrumbs %}{% endblock %}

        {# Flash Messages / Alerts #}
        {% block messages %}
            {% if messages %}
                <div class="section-container mt-4" id="flash-messages">
                    {% for message in messages %}
                        {% include 'partials/alert.html.jinja2' %}
                    {% endfor %}
                </div>
            {% endif %}
        {% endblock %}

        {# Page Content #}
        <div id="page-content">
            {% block content %}{% endblock %}
        </div>
    </main>

    {# Footer #}
    {% include 'partials/footer.html.jinja2' %}

    {# Scroll to Top Button #}
    <button
        id="scroll-to-top"
        class="hidden fixed bottom-8 right-8 btn btn-circle btn-primary shadow-lg z-50 transition-all duration-300"
        aria-label="Scroll to top"
        @click="window.scrollTo({ top: 0, behavior: 'smooth' })"
        x-show="$store.scroll.showButton"
        x-transition
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    {# Admin FAB - Floating action button for staff/superusers on non-admin pages #}
    {% set current_user = request.scope.get('user') %}
    {% if current_user and (current_user.is_staff or current_user.is_superuser) and not request.url.path.startswith('/admin') %}
    <div class="dropdown dropdown-top z-50" style="position: fixed; bottom: 2rem; left: 3rem;" x-data="{ open: false }">
        <button
            @click="open = !open"
            tabindex="0"
            class="btn btn-circle btn-lg btn-primary shadow-xl"
            aria-label="Admin menu"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>
        <ul
            x-show="open"
            @click.outside="open = false"
            x-transition
            style="display: none;"
            tabindex="0"
            class="dropdown-content menu bg-base-200 rounded-box shadow-2xl border border-base-300 p-2 w-56 mb-3"
        >
            <li class="menu-title text-xs">Quick Admin</li>
            <li><a href="/admin" hx-boost="false">Dashboard</a></li>
            <li><a href="/admin/users" hx-boost="false">Users</a></li>
            <li><a href="/admin/pages" hx-boost="false">Pages</a></li>
            <li><a href="/admin/blogs" hx-boost="false">Blog Posts</a></li>
            <li><a href="/admin/jobs" hx-boost="false">Jobs</a></li>
            <li><a href="/admin/events" hx-boost="false">Events</a></li>
            <li><a href="/admin/sponsors" hx-boost="false">Sponsors</a></li>
            <div class="divider my-1"></div>
            <li><a href="/admin/settings" hx-boost="false">Settings</a></li>
        </ul>
    </div>
    {% endif %}

    {# Toast Container for notifications - uses vanilla JS showToast() function #}
    <div id="toast-container" class="toast toast-end toast-bottom z-50"></div>

    {# HTMX Loading Indicator #}
    <div
        id="htmx-indicator"
        class="htmx-indicator fixed top-0 left-0 right-0 h-1 bg-primary z-50"
    >
        <div class="h-full bg-secondary animate-pulse"></div>
    </div>

    {# Scripts #}
    {# Alpine.js - loaded before HTMX for x-data availability #}
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    {# Lucide Icons #}
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    {# HTMX #}
    <script src="https://unpkg.com/htmx.org@2.0.0" integrity="sha384-wS5l5IKJBvK6sPTKa2WZ1js3d947pvWXbPJ1OmWfEuxLgeHcEbjUUA5i9V5ZkpCw" crossorigin="anonymous"></script>

    {# HTMX Extensions - using jsDelivr for proper MIME types #}
    <script src="https://cdn.jsdelivr.net/npm/htmx-ext-loading-states@2.0.0/loading-states.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx-ext-response-targets@2.0.0/response-targets.js"></script>

    {# Lucide Icons Initialization #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.lucide) {
                lucide.createIcons();
            }
        });
        document.body.addEventListener('htmx:afterSwap', function() {
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>

    {# Alpine.js Global Store #}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.store('scroll', {
                showButton: false,
                init() {
                    window.addEventListener('scroll', () => {
                        this.showButton = window.scrollY > 300;
                    });
                }
            });

            Alpine.store('theme', {
                dark: localStorage.getItem('theme') === 'pythondark',
                toggle() {
                    this.dark = !this.dark;
                    localStorage.setItem('theme', this.dark ? 'pythondark' : 'python');
                    document.documentElement.setAttribute('data-theme', this.dark ? 'pythondark' : 'python');
                }
            });
        });
    </script>

    {# HTMX Event Handlers - guard against re-execution from hx-boost #}
    <script>
    (function() {
        if (window._pydotorgInitialized) return;
        window._pydotorgInitialized = true;

        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            document.getElementById('htmx-indicator').style.display = 'block';
        });

        document.body.addEventListener('htmx:afterRequest', function(evt) {
            document.getElementById('htmx-indicator').style.display = 'none';
        });

        const _recentToasts = new Set();

        document.body.addEventListener('showToast', function(evt) {
            const detail = evt.detail || {};
            const message = detail.message || 'An error occurred';
            window._htmxToastHandled = true;
            setTimeout(() => { window._htmxToastHandled = false; }, 100);
            window.showToast(message, detail.type || 'error');
        });

        document.body.addEventListener('htmx:responseError', function(evt) {
            if (window._htmxToastHandled) return;
            const xhr = evt.detail.xhr;
            if (xhr?.getResponseHeader('HX-Trigger')?.includes('showToast')) return;

            const status = xhr?.status || 0;
            const path = evt.detail.pathInfo?.requestPath || 'this page';
            const friendlyPath = path.replace(/^\//, '').replace(/\//g, ' → ').replace(/-/g, ' ') || 'Home';

            let message, type;
            if (status === 404) {
                message = `'${friendlyPath}' is not available yet.`;
                type = 'info';
            } else if (status === 403) {
                message = 'You need permission to access this resource.';
                type = 'warning';
            } else if (status >= 500) {
                message = 'Something went wrong. Please try again.';
                type = 'error';
            } else {
                message = 'Unable to complete the request.';
                type = 'warning';
            }
            window.showToast(message, type);
        });

        window.showToast = function(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toastKey = `${type}:${message}`;
            if (_recentToasts.has(toastKey)) return;
            _recentToasts.add(toastKey);
            setTimeout(() => _recentToasts.delete(toastKey), 2000);

            const alertClasses = {
                'info': 'alert-info',
                'success': 'alert-success',
                'warning': 'alert-warning',
                'error': 'alert-error'
            };

            const toast = document.createElement('div');
            toast.className = `alert ${alertClasses[type] || 'alert-info'} shadow-lg`;
            toast.innerHTML = `
                <span>${message}</span>
                <button class="btn btn-ghost btn-xs" onclick="this.parentElement.remove()">✕</button>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.opacity = '0';
                    toast.style.transition = 'opacity 0.3s ease-out';
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        };

        const scrollBtn = document.getElementById('scroll-to-top');
        if (scrollBtn && !window.Alpine) {
            window.addEventListener('scroll', () => {
                scrollBtn.classList.toggle('hidden', window.scrollY <= 300);
            });
            scrollBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    })();
    </script>

    {# Custom JS from static #}
    <script src="/static/js/main.js" defer></script>

    {% block extra_js %}{% endblock %}
</body>
</html>
